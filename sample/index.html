<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>CKEditor 5 – classic editor build – development sample</title>
		<link rel="stylesheet" href="../src/custom-css.css">
		<style>
			body {
				max-width: 800px;
				margin: 20px auto;
			}
		</style>
	</head>
	<body>
		<h1>CKEditor 5 Test</h1>

		<div id="editor">
			<p><strong>Fill in the blank with the correct answer.</strong></p><p>&nbsp;</p><p>Evaluate.</p><p>&nbsp;</p><p>761 902 = 700 000 + _________ + 1000 + 900 + 2</p><p>&nbsp;</p><p>Answer =&nbsp;<span class="fill" name="FillInTheBlank">&nbsp;600000&nbsp;</span></p><p>&nbsp;</p><p><audio class="audio" controls="true"><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"></audio></p>
		</div>

		<script src="../build/ckeditor.js"></script>
		<!-- <script src="../src/custom-attribute/custom-attribute.js"></script> -->
		<script>

			const API_URL = "https://77em4-8080.sse.codesandbox.io";
			const UPLOAD_ENDPOINT = "upload_files";

			function uploadAdapter(loader) {
				return {
					upload: () => {
						return new Promise((resolve, reject) => {
							const body = new FormData();
							loader.file.then((file) => {
								body.append("files", file);
								// let headers = new Headers();
								// headers.append("Origin", "http://localhost:3000");
								fetch(`${API_URL}/${UPLOAD_ENDPOINT}`, {
									method: "post",
									body: body
									// mode: "no-cors"
								})
									.then((res) => res.json())
									.then((res) => {
										resolve({
											default: `${API_URL}/${res.filename}`
										});
									})
									.catch((err) => {
										reject(err);
									});
							});
						});
					}
				};
			}

			function uploadPlugin(editor) {
				editor.plugins.get("FileRepository").createUploadAdapter = (loader) => {
					return uploadAdapter(loader);
				};
			}

			MindtrexEditor.create(document.querySelector('#editor'),{
				fillConfig: "dragAndDrop",
				language: {
					// The UI will be English.
					ui: 'en',
					// But the content will be edited in Arabic.
					content: 'en'
				},
				extraPlugins: [ uploadPlugin ],
			})
				.then((editor) => {
					window.editor = editor
					editor.model.document.on( 'change', () => {
							console.log( editor.getData() );
					} );
					// editor.setData(`<p>Question Answer&nbsp;<span class="placeholder">{Mantap}</span></p>`)
					// console.log("initialized")
					// editor.setData(`<p>
					// 	This is Question
					// 	<div class="simple-box">
					// 		<span class="simple-box-title">answer</span>
					// 	</div>
					// </p>`)
				})
				.catch((error) => {
					console.error('There was a problem initializing the editor.', error)
				});
		</script>
	</body>
</html>
